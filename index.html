<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>BTF TV</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--g:#FFD700;--gd:#C9A800;--gl:#FFF3B0;--bk:#080808;--b2:#111;--b3:#1a1a1a;--b4:#222;--wh:#fff;--gr:#777;--gr2:#444;--rd:#E8000A;}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{font-family:'Poppins',sans-serif;background:var(--bk);color:var(--wh);max-width:480px;margin:0 auto;overflow-x:hidden;min-height:100vh;-webkit-font-smoothing:antialiased;}
/* POPUP */
#pop{position:fixed;inset:0;z-index:999;background:rgba(0,0,0,.88);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;padding:20px;transition:opacity .3s;}
#pop.off{opacity:0;pointer-events:none;}
.pop-card{background:var(--b2);border-radius:20px;overflow:hidden;width:100%;max-width:380px;border:1.5px solid var(--gd);box-shadow:0 0 50px rgba(255,215,0,.18);animation:popIn .45s cubic-bezier(.34,1.56,.64,1);}
@keyframes popIn{from{transform:scale(.8);opacity:0;}to{transform:scale(1);opacity:1;}}
.pop-img{width:100%;aspect-ratio:16/9;object-fit:cover;display:block;}
.pop-body{padding:18px 20px 22px;}
.pop-title{font-family:'Bebas Neue',cursive;font-size:1.65rem;color:var(--g);letter-spacing:1px;}
.pop-sub{font-size:.78rem;color:var(--gr);margin-top:4px;line-height:1.5;}
.pop-acts{display:flex;gap:10px;margin-top:16px;}
.pop-cta{flex:1;background:var(--g);color:var(--bk);border:none;padding:12px;border-radius:10px;font-family:'Poppins',sans-serif;font-weight:800;font-size:.85rem;cursor:pointer;}
.pop-dis{background:var(--b4);color:var(--gr);border:1px solid var(--gr2);padding:12px 14px;border-radius:10px;font-family:'Poppins',sans-serif;font-size:.8rem;cursor:pointer;white-space:nowrap;}
/* HEADER */
header{background:var(--bk);padding:14px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:50;border-bottom:2px solid var(--gd);}
.logo{font-family:'Bebas Neue',cursive;font-size:2rem;letter-spacing:3px;color:var(--g);text-shadow:0 0 18px rgba(255,215,0,.4);cursor:pointer;}
.logo span{color:var(--rd);}
.hicons{display:flex;gap:14px;align-items:center;}
.hbtn{background:none;border:none;cursor:pointer;color:var(--wh);font-size:1.25rem;padding:2px;}
/* SEARCH BAR */
.srch{margin:12px 16px;display:flex;align-items:center;background:var(--b3);border:1px solid var(--b4);border-radius:30px;padding:9px 16px;gap:10px;cursor:pointer;}
.srch span{color:var(--gr);font-size:.9rem;}
.srch p{color:var(--gr);font-size:.88rem;pointer-events:none;}
/* TABS */
.tabs{display:flex;overflow-x:auto;gap:8px;padding:10px 16px;scrollbar-width:none;}
.tabs::-webkit-scrollbar{display:none;}
.tab{flex-shrink:0;padding:6px 16px;border-radius:20px;font-size:.78rem;font-weight:600;cursor:pointer;border:1.5px solid var(--gr2);background:none;color:var(--gr);transition:all .2s;font-family:'Poppins',sans-serif;}
.tab.on,.tab:active{background:var(--g);color:var(--bk);border-color:var(--g);}
/* HERO BANNER */
.hero{position:relative;width:100%;padding-top:56.25%;overflow:hidden;cursor:pointer;}
.hero-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;}
.hero-shade{position:absolute;inset:0;background:linear-gradient(to top,rgba(8,8,8,.95) 0%,rgba(8,8,8,.3) 50%,rgba(8,8,8,.1) 100%);}
.hero-info{position:absolute;bottom:0;left:0;right:0;padding:18px 16px;z-index:3;}
.hero-tag{display:inline-block;background:var(--rd);color:var(--wh);font-size:.65rem;font-weight:700;padding:3px 10px;border-radius:4px;letter-spacing:.8px;margin-bottom:7px;text-transform:uppercase;}
.hero-title{font-family:'Bebas Neue',cursive;font-size:2.2rem;line-height:1;color:var(--wh);letter-spacing:.5px;}
.hero-title span{color:var(--g);}
.hero-meta{font-size:.72rem;color:var(--gr);margin:5px 0 12px;}
.hero-meta b{color:var(--gl);}
.hero-acts{display:flex;gap:10px;}
.btn-play{background:var(--g);color:var(--bk);border:none;padding:10px 20px;border-radius:8px;font-family:'Poppins',sans-serif;font-weight:800;font-size:.82rem;cursor:pointer;}
.btn-wl{background:rgba(255,255,255,.08);color:var(--wh);border:1.5px solid rgba(255,255,255,.25);padding:10px 16px;border-radius:8px;font-family:'Poppins',sans-serif;font-size:.82rem;font-weight:600;cursor:pointer;}
/* SECTION */
.sch{display:flex;align-items:center;justify-content:space-between;padding:18px 16px 10px;}
.stitle{font-family:'Bebas Neue',cursive;font-size:1.35rem;letter-spacing:1px;color:var(--wh);display:flex;align-items:center;gap:8px;}
.stitle::before{content:'';display:inline-block;width:3px;height:20px;background:var(--g);border-radius:2px;}
.sea{font-size:.73rem;color:var(--g);font-weight:600;cursor:pointer;}
/* SCROLL ROW */
.srow{display:flex;overflow-x:auto;gap:12px;padding:0 16px 16px;scrollbar-width:none;}
.srow::-webkit-scrollbar{display:none;}
/* VIDEO CARD 9:16 */
.vc{flex-shrink:0;width:128px;cursor:pointer;}
.vt{width:100%;padding-top:177.78%;position:relative;border-radius:10px;overflow:hidden;background:var(--b3);}
.vt img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;}
.vt-shade{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.7) 0%,transparent 50%);}
.vt-fallback{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:2.8rem;}
.bdg{position:absolute;top:7px;left:7px;z-index:3;font-size:.58rem;font-weight:700;padding:2px 8px;border-radius:4px;letter-spacing:.5px;text-transform:uppercase;}
.b-new,.b-hot{background:var(--rd);color:var(--wh);}
.b-premium{background:var(--g);color:var(--bk);}
.b-free{background:#1a7a1a;color:var(--wh);}
.vdur{position:absolute;bottom:7px;right:7px;z-index:3;background:rgba(0,0,0,.75);color:var(--wh);font-size:.6rem;padding:2px 6px;border-radius:4px;}
.vi{padding:7px 2px 0;}
.vtit{font-size:.76rem;font-weight:600;color:var(--wh);line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.vsub{font-size:.66rem;color:var(--gr);margin-top:2px;}
/* CONTENT CARD 4:3 */
.cc{flex-shrink:0;width:158px;cursor:pointer;}
.ct{width:100%;padding-top:75%;position:relative;border-radius:10px;overflow:hidden;background:var(--b3);}
.ct img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;}
.ct-shade{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.65) 0%,transparent 55%);}
.ct-fallback{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:2.5rem;}
.ci{padding:7px 2px 0;}
.ctit{font-size:.78rem;font-weight:600;color:var(--wh);line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.cmeta{font-size:.66rem;color:var(--gr);margin-top:2px;}
/* CONTINUE WATCHING */
.pwc{flex-shrink:0;width:172px;cursor:pointer;}
.pwt{width:100%;padding-top:56.25%;position:relative;border-radius:10px;overflow:hidden;background:var(--b3);}
.pwt img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;}
.pwt-fb{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:2.5rem;}
.pw-shade{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.7) 0%,transparent 55%);}
.pw-play{position:absolute;right:8px;bottom:12px;z-index:5;width:30px;height:30px;background:rgba(255,215,0,.9);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.8rem;}
.pw-bar-w{position:absolute;bottom:0;left:0;right:0;height:3px;background:rgba(255,255,255,.15);z-index:4;}
.pw-bar{height:100%;background:var(--rd);}
.pwi{padding:6px 2px 0;}
.pwtit{font-size:.76rem;font-weight:600;color:var(--wh);}
.pwsub{font-size:.64rem;color:var(--gr);margin-top:2px;}
/* CATEGORIES */
.cgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:0 16px 16px;}
.citem{position:relative;border-radius:10px;overflow:hidden;cursor:pointer;aspect-ratio:1;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:4px;}
.citem:active{transform:scale(.95);}
.ci-bg{position:absolute;inset:0;opacity:.5;}
.ci-lbl{position:relative;z-index:2;font-family:'Bebas Neue',cursive;font-size:1rem;letter-spacing:.8px;color:var(--wh);text-shadow:0 2px 8px rgba(0,0,0,.8);}
.ci-ico{font-size:1.6rem;position:relative;z-index:2;}
/* PROMO */
.promo{margin:8px 16px 16px;background:linear-gradient(135deg,var(--gd),var(--g),var(--gd));border-radius:14px;padding:18px;display:flex;align-items:center;justify-content:space-between;position:relative;overflow:hidden;cursor:pointer;}
.promo::after{content:'‚òÖ';position:absolute;right:-10px;top:-10px;font-size:80px;color:rgba(255,255,255,.12);line-height:1;}
.ptxt h3{font-family:'Bebas Neue',cursive;font-size:1.35rem;color:var(--bk);letter-spacing:.8px;}
.ptxt p{font-size:.72rem;color:rgba(0,0,0,.6);margin-top:2px;}
.pcta{background:var(--bk);color:var(--g);border:none;padding:9px 14px;border-radius:8px;font-family:'Poppins',sans-serif;font-weight:700;font-size:.78rem;cursor:pointer;flex-shrink:0;white-space:nowrap;}
/* NAV */
.bnav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;background:var(--b2);border-top:1px solid #222;display:flex;justify-content:space-around;align-items:center;padding:8px 0 14px;z-index:60;}
.ni{display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;padding:2px 10px;}
.ni.on .nl{color:var(--g);}
.ni:active{transform:scale(.9);}
.nio{font-size:1.2rem;}
.nl{font-size:.62rem;color:var(--gr);font-weight:600;}
.nc{width:48px;height:48px;background:var(--g);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.4rem;cursor:pointer;box-shadow:0 0 20px rgba(255,215,0,.35);margin-top:-14px;border:3px solid var(--b2);}
.nc:active{background:var(--rd);}
.sp{height:80px;}
/* SEARCH OVERLAY */
#so{position:fixed;inset:0;z-index:80;background:var(--bk);transform:translateY(-100%);transition:transform .3s cubic-bezier(.4,0,.2,1);padding-bottom:80px;overflow-y:auto;}
#so.on{transform:translateY(0);}
.so-hd{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid #1e1e1e;position:sticky;top:0;background:var(--bk);z-index:2;}
.so-inp{flex:1;background:var(--b3);border:1px solid var(--gd);border-radius:12px;padding:10px 16px;color:var(--wh);font-family:'Poppins',sans-serif;font-size:.95rem;outline:none;}
.so-cl{background:var(--b3);border:none;color:var(--wh);width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
.so-res{padding:12px 16px;}
.sri{display:flex;align-items:center;gap:12px;padding:12px;background:var(--b2);border-radius:12px;margin-bottom:8px;cursor:pointer;}
.sri:active{background:var(--b3);}
.sr-em{width:50px;height:50px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0;overflow:hidden;}
.sr-em img{width:100%;height:100%;object-fit:cover;}
.sri-inf{flex:1;}
.sri-t{font-size:.85rem;font-weight:600;color:var(--wh);}
.sri-m{font-size:.7rem;color:var(--gr);margin-top:2px;}
.sempty{text-align:center;padding:40px 16px;color:var(--gr);font-size:.9rem;}
/* TOAST */
#toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--b3);color:var(--wh);border:1px solid var(--b4);padding:10px 20px;border-radius:30px;font-size:.8rem;font-weight:600;z-index:999;opacity:0;transition:all .3s;pointer-events:none;white-space:nowrap;}
#toast.on{opacity:1;transform:translateX(-50%) translateY(0);}
@keyframes fu{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}
.fu{animation:fu .4s ease forwards;}
</style>
</head>
<body>

<!-- POPUP -->
<div id="pop" class="off">
  <div class="pop-card">
    <img id="pop-img" class="pop-img" src="" alt="">
    <div class="pop-body">
      <div class="pop-title" id="pop-title"></div>
      <div class="pop-sub" id="pop-sub"></div>
      <div class="pop-acts">
        <button class="pop-cta" id="pop-cta"></button>
        <button class="pop-dis" id="pop-dis"></button>
      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- SEARCH OVERLAY -->
<div id="so">
  <div class="so-hd">
    <input type="text" class="so-inp" id="so-inp" placeholder="Shows, Podcasts ‡§ñ‡•ã‡§ú‡•á‡§Ç..." oninput="doSearch(this.value)">
    <button class="so-cl" onclick="closeSO()">‚úï</button>
  </div>
  <div class="so-res" id="so-res"></div>
</div>

<!-- HEADER -->
<header>
  <div class="logo" id="logo" onclick="window.scrollTo(0,0)"></div>
  <div class="hicons">
    <button class="hbtn" onclick="openSO()">üîç</button>
    <button class="hbtn">üîî</button>
    <button class="hbtn">üë§</button>
  </div>
</header>

<!-- SEARCH BAR -->
<div class="srch" onclick="openSO()">
  <span>üîç</span>
  <p>Shows, Podcasts ‡§ñ‡•ã‡§ú‡•á‡§Ç...</p>
</div>

<!-- TABS -->
<div class="tabs" id="tabs"></div>

<!-- HERO -->
<div class="hero" id="hero" onclick="heroCk()">
  <img id="hero-img" class="hero-img" src="" alt="" onerror="this.style.display='none'">
  <div class="hero-shade"></div>
  <div class="hero-info">
    <div class="hero-tag" id="hero-tag"></div>
    <div class="hero-title" id="hero-title"></div>
    <div class="hero-meta" id="hero-meta"></div>
    <div class="hero-acts">
      <button class="btn-play" onclick="event.stopPropagation();heroCk()">‚ñ∂ ‡§Ö‡§≠‡•Ä ‡§¶‡•á‡§ñ‡•á‡§Ç</button>
      <button class="btn-wl" onclick="event.stopPropagation();toast('Watchlist mein add! ‚úÖ')">+ Watchlist</button>
    </div>
  </div>
</div>

<!-- CONTINUE WATCHING -->
<div id="cw-sec" style="display:none">
  <div class="sch"><div class="stitle" id="cw-title">‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç</div></div>
  <div class="srow" id="cw-row"></div>
</div>

<!-- TRENDING 9:16 -->
<div class="sch">
  <div class="stitle" id="feat-title">Trending</div>
  <span class="sea" onclick="toast('Explore soon!')">‡§∏‡§¨ ‡§¶‡•á‡§ñ‡•á‡§Ç ‚Üí</span>
</div>
<div class="srow" id="feat-row"></div>

<!-- PROMO -->
<div class="promo" id="promo" onclick="promoCk()">
  <div class="ptxt">
    <h3 id="promo-title"></h3>
    <p id="promo-sub"></p>
  </div>
  <button class="pcta" id="promo-cta" onclick="event.stopPropagation();promoCk()"></button>
</div>

<!-- NEW RELEASES 4:3 -->
<div class="sch">
  <div class="stitle" id="nr-title">New Releases</div>
  <span class="sea" onclick="toast('All releases soon!')">‡§∏‡§¨ ‡§¶‡•á‡§ñ‡•á‡§Ç ‚Üí</span>
</div>
<div class="srow" id="nr-row"></div>

<!-- CATEGORIES -->
<div class="sch"><div class="stitle">Categories</div></div>
<div class="cgrid" id="cat-grid"></div>

<!-- PODCASTS 4:3 -->
<div class="sch">
  <div class="stitle" id="pod-title">Top Podcasts</div>
  <span class="sea" onclick="toast('All podcasts soon!')">‡§∏‡§¨ ‡§¶‡•á‡§ñ‡•á‡§Ç ‚Üí</span>
</div>
<div class="srow" id="pod-row"></div>

<div class="sp"></div>

<!-- BOTTOM NAV -->
<nav class="bnav">
  <div class="ni on" onclick="navCk(this,'home')"><span class="nio">üè†</span><span class="nl" style="color:var(--g)">Home</span></div>
  <div class="ni"    onclick="navCk(this,'explore')"><span class="nio">üß≠</span><span class="nl">Explore</span></div>
  <div class="nc" onclick="toast('Live TV coming soon! üî¥')">‚ñ∂</div>
  <div class="ni"    onclick="navCk(this,'downloads')"><span class="nio">üíæ</span><span class="nl">Downloads</span></div>
  <div class="ni"    onclick="navCk(this,'profile')"><span class="nio">üë§</span><span class="nl">Profile</span></div>
</nav>

<script>
let D=null, history_=JSON.parse(localStorage.getItem('btftv_h')||'{}');

async function load(){
  try{const r=await fetch('./data.json');if(!r.ok)throw 0;D=await r.json();}
  catch{D=null;document.body.innerHTML='<p style="color:#fff;padding:20px;font-family:sans-serif">‚ö†Ô∏è data.json not found. Place data.json in same folder.</p>';return;}
  init();
}

function init(){
  setFavicon();
  setLogo();
  renderTabs();
  renderHero();
  renderCW();
  renderFeatured(null);
  renderPromo();
  renderNewReleases();
  renderCategories();
  renderPodcasts();
  showPopup();
}

function setFavicon(){
  const f=D.site.favicon_url;
  if(!f)return;
  let l=document.querySelector("link[rel='icon']")||document.createElement('link');
  l.rel='icon';l.href=f;
  document.head.appendChild(l);
  document.title=D.site.name;
}

function setLogo(){
  const s=D.site;
  document.getElementById('logo').innerHTML=s.logo_text+'<span>'+s.logo_highlight+'</span>';
}

function renderTabs(){
  document.getElementById('tabs').innerHTML=D.tabs.map(t=>
    `<button class="tab${t.active?' on':''}" onclick="tabCk(this,'${t.id}')">${t.label}</button>`
  ).join('');
}
function tabCk(el,id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('on'));
  el.classList.add('on');
  renderFeatured(id==='all'?null:id);
}

function renderHero(){
  const b=D.banner;
  document.getElementById('hero-img').src=b.image_url||'';
  document.getElementById('hero-tag').textContent=b.tag;
  document.getElementById('hero-title').innerHTML=b.title+' <span>'+b.title_highlight+'</span>';
  document.getElementById('hero-meta').innerHTML=b.genre+' &nbsp;|&nbsp; <b>'+b.rating+'</b> &nbsp;|&nbsp; '+b.language+' ¬∑ '+b.year;
}
function heroCk(){
  const b=D.banner;
  location.href='show.html?id='+b.story_id;
}

function renderCW(){
  const sec=document.getElementById('cw-sec');
  const h=Object.values(history_);
  if(!h.length){sec.style.display='none';return;}
  sec.style.display='block';
  document.getElementById('cw-title').textContent=D.sections?.continue_watching?.title||'‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡•á‡§Ç';
  document.getElementById('cw-row').innerHTML=h.slice(0,5).map(hh=>{
    const sh=D.shows.find(s=>s.id===hh.sid);if(!sh)return'';
    const ep=sh.episodes[hh.ei]||sh.episodes[0];
    const pct=Math.min(Math.round((hh.t/hh.d)*100)||25,100);
    return`<div class="pwc" onclick="goPlay('${sh.id}',${hh.ei})">
      <div class="pwt" style="background:${sh.gradient}">
        <img src="${ep.thumbnail_url||''}" alt="" onerror="this.style.display='none'">
        <div class="pwt-fb">${sh.emoji}</div>
        <div class="pw-shade"></div>
        <div class="pw-play">‚ñ∂</div>
        <div class="pw-bar-w"><div class="pw-bar" style="width:${pct}%"></div></div>
      </div>
      <div class="pwi"><div class="pwtit">${sh.title}</div><div class="pwsub">Ep ${ep.ep} ¬∑ ${ep.duration}</div></div>
    </div>`;
  }).join('');
}

function renderFeatured(filt){
  document.getElementById('feat-title').textContent=D.sections?.featured?.title||'Trending Shows';
  let shows=(D.sections?.featured?.show_ids||[]).map(id=>D.shows.find(s=>s.id===id)).filter(Boolean);
  if(filt)shows=shows.filter(s=>s.category===filt||s.genre.toLowerCase()===filt);
  if(!shows.length&&filt)shows=D.shows.filter(s=>s.category===filt);
  document.getElementById('feat-row').innerHTML=shows.map(s=>
    `<div class="vc fu" onclick="location.href='show.html?id=${s.id}'">
      <div class="vt" style="background:${s.gradient}">
        <img src="${s.poster_url||''}" alt="${s.title}" onerror="this.style.display='none'">
        <div class="vt-fallback" id="vf-${s.id}">${s.emoji}</div>
        <div class="vt-shade"></div>
        <span class="bdg b-${s.badge_type}">${s.badge}</span>
        <span class="vdur">S1 ¬∑ ${s.total_episodes} Eps</span>
      </div>
      <div class="vi"><div class="vtit">${s.title}</div><div class="vsub">${s.genre} ¬∑ ${s.language}</div></div>
    </div>`
  ).join('');
  // Hide fallback emoji when image loads
  shows.forEach(s=>{
    const imgs=document.querySelectorAll(`[onclick*="${s.id}"] .vt img`);
    imgs.forEach(img=>{
      img.onload=()=>{const fb=img.parentElement.querySelector('.vt-fallback');if(fb)fb.style.display='none';};
    });
  });
}

function renderNewReleases(){
  document.getElementById('nr-title').textContent=D.sections?.new_releases?.title||'New Releases';
  const shows=(D.sections?.new_releases?.show_ids||[]).map(id=>D.shows.find(s=>s.id===id)).filter(Boolean);
  document.getElementById('nr-row').innerHTML=shows.map(s=>
    `<div class="cc" onclick="location.href='show.html?id=${s.id}'">
      <div class="ct" style="background:${s.gradient}">
        <img src="${s.banner_url||s.poster_url||''}" alt="${s.title}" onerror="this.style.display='none'">
        <div class="ct-fallback">${s.emoji}</div>
        <div class="ct-shade"></div>
        <span class="bdg b-${s.badge_type}">${s.badge}</span>
        <span class="vdur">${s.episodes[0]?.duration||''}</span>
      </div>
      <div class="ci"><div class="ctit">${s.title}</div><div class="cmeta">${s.genre} ¬∑ ${s.year}</div></div>
    </div>`
  ).join('');
}

function renderCategories(){
  document.getElementById('cat-grid').innerHTML=D.categories.map(c=>
    `<div class="citem" onclick="tabCk2('${c.id}')">
      <div class="ci-bg" style="background:${c.gradient}"></div>
      <span class="ci-ico">${c.emoji}</span>
      <span class="ci-lbl">${c.label}</span>
    </div>`
  ).join('');
}
function tabCk2(id){
  document.querySelectorAll('.tab').forEach(t=>{
    if(t.dataset&&t.getAttribute('onclick')?.includes("'"+id+"'")){t.classList.add('on');}else{t.classList.remove('on');}
  });
  renderFeatured(id);
  window.scrollTo({top:0,behavior:'smooth'});
}

function renderPodcasts(){
  document.getElementById('pod-title').textContent=D.sections?.podcasts?.title||'Top Podcasts';
  const shows=(D.sections?.podcasts?.show_ids||[]).map(id=>D.shows.find(s=>s.id===id)).filter(Boolean);
  document.getElementById('pod-row').innerHTML=shows.map(s=>
    `<div class="cc" onclick="location.href='show.html?id=${s.id}'">
      <div class="ct" style="background:${s.gradient}">
        <img src="${s.banner_url||s.poster_url||''}" alt="${s.title}" onerror="this.style.display='none'">
        <div class="ct-fallback">${s.emoji}</div>
        <div class="ct-shade"></div>
        <span class="bdg b-${s.badge_type}">${s.badge}</span>
      </div>
      <div class="ci"><div class="ctit">${s.title}</div><div class="cmeta">${s.genre} ¬∑ ${s.total_episodes} Eps</div></div>
    </div>`
  ).join('');
}

function renderPromo(){
  const p=D.promo_banner;
  const el=document.getElementById('promo');
  if(!p||!p.enabled){el.style.display='none';return;}
  document.getElementById('promo-title').textContent=p.title;
  document.getElementById('promo-sub').textContent=p.subtitle;
  document.getElementById('promo-cta').textContent=p.button_text;
}
function promoCk(){const p=D.promo_banner;if(p?.button_link)location.href=p.button_link;}

function showPopup(){
  const p=D.popup;
  if(!p||!p.enabled)return;
  if(p.show_once&&localStorage.getItem('btftv_pop'))return;
  const el=document.getElementById('pop');
  const img=document.getElementById('pop-img');
  img.src=p.image_url||'';
  img.onerror=()=>img.style.display='none';
  document.getElementById('pop-title').textContent=p.title;
  document.getElementById('pop-sub').textContent=p.subtitle;
  document.getElementById('pop-cta').textContent=p.button_text;
  document.getElementById('pop-cta').onclick=()=>{closePopup();location.href=p.button_link;};
  document.getElementById('pop-dis').textContent=p.dismiss_text;
  document.getElementById('pop-dis').onclick=closePopup;
  setTimeout(()=>el.classList.remove('off'),400);
}
function closePopup(){
  document.getElementById('pop').classList.add('off');
  if(D.popup?.show_once)localStorage.setItem('btftv_pop','1');
}

function goPlay(sid,ei){location.href='player.html?sid='+sid+'&ei='+ei;}

function openSO(){document.getElementById('so').classList.add('on');setTimeout(()=>document.getElementById('so-inp').focus(),300);}
function closeSO(){document.getElementById('so').classList.remove('on');document.getElementById('so-inp').value='';document.getElementById('so-res').innerHTML='';}
function doSearch(q){
  const w=document.getElementById('so-res');
  if(!q.trim()){w.innerHTML='';return;}
  const ql=q.toLowerCase();
  const res=D.shows.filter(s=>s.title.toLowerCase().includes(ql)||s.genre.toLowerCase().includes(ql)||s.description.toLowerCase().includes(ql));
  if(!res.length){w.innerHTML='<div class="sempty">üîç ‡§ï‡•ã‡§à result ‡§®‡§π‡•Ä‡§Ç</div>';return;}
  w.innerHTML=res.map(s=>
    `<div class="sri" onclick="closeSO();location.href='show.html?id=${s.id}'">
      <div class="sr-em" style="background:${s.gradient}"><img src="${s.poster_url}" alt="" onerror="this.style.display='none'">${s.emoji}</div>
      <div class="sri-inf"><div class="sri-t">${s.title}</div><div class="sri-m">${s.genre} ¬∑ ${s.language} ¬∑ ${s.episodes.length} Eps</div></div>
      <span class="bdg b-${s.badge_type}">${s.badge}</span>
    </div>`
  ).join('');
}

function navCk(el,tab){
  document.querySelectorAll('.ni').forEach(n=>{n.classList.remove('on');n.querySelector('.nl').style.color='';});
  el.classList.add('on');el.querySelector('.nl').style.color='var(--g)';
  if(tab!=='home')toast(tab.charAt(0).toUpperCase()+tab.slice(1)+' coming soon!');
}
function toast(msg){
  const t=document.getElementById('toast');t.textContent=msg;t.classList.add('on');
  setTimeout(()=>t.classList.remove('on'),2500);
}

load();
</script>
</body>
</html>
